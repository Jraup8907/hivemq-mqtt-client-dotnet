import{a as G,b as v,c as I}from"./chunk-CXT7N4L6.min.js";import{j as A,k as W}from"./chunk-EKFGDCJ4.min.js";import{$a as P,G as _,Ga as y,I as C,J as R,Ka as O,Za as T,b as J,c as Z,h as E,jb as S}from"./chunk-YICCS3KT.min.js";import{d as N}from"./chunk-P42HNYSU.min.js";var at=N(J(),1),it=N(Z(),1),nt=N(R(),1),X=0,F=function(t,e,a,r,i){let n=function(t){switch(t){case i.db.relationType.AGGREGATION:return"aggregation";case i.db.relationType.EXTENSION:return"extension";case i.db.relationType.COMPOSITION:return"composition";case i.db.relationType.DEPENDENCY:return"dependency";case i.db.relationType.LOLLIPOP:return"lollipop"}};e.points=e.points.filter((t=>!Number.isNaN(t.y)));let d=e.points,o=_().x((function(t){return t.x})).y((function(t){return t.y})).curve(C),s=t.append("path").attr("d",o(d)).attr("id","edge"+X).attr("class","relation"),l="";r.arrowMarkerAbsolute&&(l=window.location.protocol+"//"+window.location.host+window.location.pathname+window.location.search,l=l.replace(/\(/g,"\\("),l=l.replace(/\)/g,"\\)")),1==a.relation.lineType&&s.attr("class","relation dashed-line"),10==a.relation.lineType&&s.attr("class","relation dotted-line"),"none"!==a.relation.type1&&s.attr("marker-start","url("+l+"#"+n(a.relation.type1)+"Start)"),"none"!==a.relation.type2&&s.attr("marker-end","url("+l+"#"+n(a.relation.type2)+"End)");let p,g,h,c,f,x,u=e.points.length,m=T.calcLabelPosition(e.points);if(p=m.x,g=m.y,u%2!=0&&u>1){let t=T.calcCardinalityPosition("none"!==a.relation.type1,e.points,e.points[0]),r=T.calcCardinalityPosition("none"!==a.relation.type2,e.points,e.points[u-1]);y.debug("cardinality_1_point "+JSON.stringify(t)),y.debug("cardinality_2_point "+JSON.stringify(r)),h=t.x,c=t.y,f=r.x,x=r.y}if(void 0!==a.title){let e=t.append("g").attr("class","classLabel"),i=e.append("text").attr("class","label").attr("x",p).attr("y",g).attr("fill","red").attr("text-anchor","middle").text(a.title);window.label=i;let n=i.node().getBBox();e.insert("rect",":first-child").attr("class","box").attr("x",n.x-r.padding/2).attr("y",n.y-r.padding/2).attr("width",n.width+r.padding).attr("height",n.height+r.padding)}y.info("Rendering relation "+JSON.stringify(a)),void 0!==a.relationTitle1&&"none"!==a.relationTitle1&&t.append("g").attr("class","cardinality").append("text").attr("class","type1").attr("x",h).attr("y",c).attr("fill","black").attr("font-size","6").text(a.relationTitle1),void 0!==a.relationTitle2&&"none"!==a.relationTitle2&&t.append("g").attr("class","cardinality").append("text").attr("class","type2").attr("x",f).attr("y",x).attr("fill","black").attr("font-size","6").text(a.relationTitle2),X++},U=function(t,e,a,r){y.debug("Rendering class ",e,a);let i,n=e.id,d={id:n,label:e.id,width:0,height:0},o=t.append("g").attr("id",r.db.lookUpDomId(n)).attr("class","classGroup");i=e.link?o.append("svg:a").attr("xlink:href",e.link).attr("target",e.linkTarget).append("text").attr("y",a.textHeight+a.padding).attr("x",0):o.append("text").attr("y",a.textHeight+a.padding).attr("x",0);let s=!0;e.annotations.forEach((function(t){let e=i.append("tspan").text("\xab"+t+"\xbb");s||e.attr("dy",a.textHeight),s=!1}));let l=$(e),p=i.append("tspan").text(l).attr("class","title");s||p.attr("dy",a.textHeight);let g,h,c,f=i.node().getBBox().height;if(e.members.length>0){g=o.append("line").attr("x1",0).attr("y1",a.padding+f+a.dividerMargin/2).attr("y2",a.padding+f+a.dividerMargin/2);let t=o.append("text").attr("x",a.padding).attr("y",f+a.dividerMargin+a.textHeight).attr("fill","white").attr("class","classText");s=!0,e.members.forEach((function(e){Y(t,e,s,a),s=!1})),h=t.node().getBBox()}if(e.methods.length>0){c=o.append("line").attr("x1",0).attr("y1",a.padding+f+a.dividerMargin+h.height).attr("y2",a.padding+f+a.dividerMargin+h.height);let t=o.append("text").attr("x",a.padding).attr("y",f+2*a.dividerMargin+h.height+a.textHeight).attr("fill","white").attr("class","classText");s=!0,e.methods.forEach((function(e){Y(t,e,s,a),s=!1}))}let x=o.node().getBBox();var u=" ";e.cssClasses.length>0&&(u+=e.cssClasses.join(" "));let m=o.insert("rect",":first-child").attr("x",0).attr("y",0).attr("width",x.width+2*a.padding).attr("height",x.height+a.padding+.5*a.dividerMargin).attr("class",u).node().getBBox().width;return i.node().childNodes.forEach((function(t){t.setAttribute("x",(m-t.getBBox().width)/2)})),e.tooltip&&i.insert("title").text(e.tooltip),g&&g.attr("x2",m),c&&c.attr("x2",m),d.width=m,d.height=x.height+a.padding+.5*a.dividerMargin,d},$=function(t){let e=t.id;return t.type&&(e+="<"+O(t.type)+">"),e},z=function(t,e,a,r){y.debug("Rendering note ",e,a);let i=e.id,n={id:i,text:e.text,width:0,height:0},d=t.append("g").attr("id",i).attr("class","classGroup"),o=d.append("text").attr("y",a.textHeight+a.padding).attr("x",0),s=JSON.parse(`"${e.text}"`).split("\n");s.forEach((function(t){y.debug(`Adding line: ${t}`),o.append("tspan").text(t).attr("class","title").attr("dy",a.textHeight)}));let l=d.node().getBBox(),p=d.insert("rect",":first-child").attr("x",0).attr("y",0).attr("width",l.width+2*a.padding).attr("height",l.height+s.length*a.textHeight+a.padding+.5*a.dividerMargin).node().getBBox().width;return o.node().childNodes.forEach((function(t){t.setAttribute("x",(p-t.getBBox().width)/2)})),n.width=p,n.height=l.height+s.length*a.textHeight+a.padding+.5*a.dividerMargin,n},Y=function(t,e,a,r){let{displayText:i,cssStyle:n}=e.getDisplayDetails(),d=t.append("tspan").attr("x",r.padding).text(i);""!==n&&d.attr("style",e.cssStyle),a||d.attr("dy",r.textHeight)},H={getClassTitleString:$,drawClass:U,drawEdge:F,drawNote:z},M={},B=20,L=function(t){let e=Object.entries(M).find((e=>e[1].label===t));if(e)return e[0]},V=function(t){t.append("defs").append("marker").attr("id","extensionStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 1,7 L18,13 V 1 Z"),t.append("defs").append("marker").attr("id","extensionEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 1,1 V 13 L18,7 Z"),t.append("defs").append("marker").attr("id","compositionStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id","compositionEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id","aggregationStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id","aggregationEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id","dependencyStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 5,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id","dependencyEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L14,7 L9,1 Z")},q=function(t,e,a,r){let i=S().class;M={},y.info("Rendering diagram "+t);let n,d=S().securityLevel;"sandbox"===d&&(n=E("#i"+e));let o=E("sandbox"===d?n.nodes()[0].contentDocument.body:"body"),s=o.select(`[id='${e}']`);V(s);let l=new A({multigraph:!0});l.setGraph({isMultiGraph:!0}),l.setDefaultEdgeLabel((function(){return{}}));let p=r.db.getClasses(),g=Object.keys(p);for(let u of g){let t=p[u],e=H.drawClass(s,t,i,r);M[e.id]=e,l.setNode(e.id,e),y.info("Org height: "+e.height)}r.db.getRelations().forEach((function(t){y.info("tjoho"+L(t.id1)+L(t.id2)+JSON.stringify(t)),l.setEdge(L(t.id1),L(t.id2),{relation:t},t.title||"DEFAULT")})),r.db.getNotes().forEach((function(t){y.debug(`Adding note: ${JSON.stringify(t)}`);let e=H.drawNote(s,t,i,r);M[e.id]=e,l.setNode(e.id,e),t.class&&t.class in p&&l.setEdge(t.id,L(t.class),{relation:{id1:t.id,id2:t.class,relation:{type1:"none",type2:"none",lineType:10}}},"DEFAULT")})),W(l),l.nodes().forEach((function(t){void 0!==t&&void 0!==l.node(t)&&(y.debug("Node "+t+": "+JSON.stringify(l.node(t))),o.select("#"+(r.db.lookUpDomId(t)||t)).attr("transform","translate("+(l.node(t).x-l.node(t).width/2)+","+(l.node(t).y-l.node(t).height/2)+" )"))})),l.edges().forEach((function(t){void 0!==t&&void 0!==l.edge(t)&&(y.debug("Edge "+t.v+" -> "+t.w+": "+JSON.stringify(l.edge(t))),H.drawEdge(s,l.edge(t),l.edge(t).relation,i,r))}));let h=s.node().getBBox(),c=h.width+2*B,f=h.height+2*B;P(s,f,c,i.useMaxWidth);let x=`${h.x-B} ${h.y-B} ${c} ${f}`;y.debug(`viewBox ${x}`),s.attr("viewBox",x)},K={draw:q},dt={parser:G,db:v,renderer:K,styles:I,init:t=>{t.class||(t.class={}),t.class.arrowMarkerAbsolute=t.arrowMarkerAbsolute,v.clear()}};export{dt as diagram};