import{a as V,b as Y,c as W,d as z,e as w,f as q,g as G,h as K}from"./chunk-CK25GZVZ.min.js";import{a as U}from"./chunk-YAMJ4ASO.min.js";import"./chunk-3RELVOUY.min.js";import"./chunk-DALFUHAB.min.js";import{j as H}from"./chunk-EKFGDCJ4.min.js";import{$a as J,Ga as l,J as rt,La as g,Za as j,b as it,c as ct,h as y,jb as h}from"./chunk-YICCS3KT.min.js";import{d as R}from"./chunk-P42HNYSU.min.js";var Mt=R(it(),1),Ht=R(ct(),1),Ut=R(rt(),1),x="rect",N="rectWithTitle",lt="start",at="end",dt="divider",Et="roundedWithTitle",St="note",pt="noteGroup",_="statediagram",Tt="state",_t=`${_}-${Tt}`,X="transition",ut="note",bt="note-edge",ft=`${X} ${bt}`,Dt=`${_}-${ut}`,ht="cluster",At=`${_}-${ht}`,yt="cluster-alt",gt=`${_}-${yt}`,Z="parent",F="note",xt="state",O="----",$t=`${O}${F}`,Q=`${O}${Z}`,I="fill:none",tt="fill: #333",et="c",ot="text",st="normal",$={},E=0,Ct=function(t){let e=Object.keys(t);for(let s of e)t[s]},Rt=function(t,e){return e.db.extract(e.db.getRootDocV2()),e.db.getClasses()};function wt(t){return null==t?"":t.classes?t.classes.join(" "):""}function L(t="",e=0,s="",a=O){let i=null!==s&&s.length>0?`${a}${s}`:"";return`${xt}-${t}${i}-${e}`}var A=(t,e,s,a,i,r)=>{let o=s.id,n=wt(a[o]);if("root"!==o){let e=x;!0===s.start&&(e=lt),!1===s.start&&(e=at),s.type!==w&&(e=s.type),$[o]||($[o]={id:o,shape:e,description:g.sanitizeText(o,h()),classes:`${n} ${_t}`});let a=$[o];s.description&&(Array.isArray(a.description)?(a.shape=N,a.description.push(s.description)):a.description.length>0?(a.shape=N,a.description===o?a.description=[s.description]:a.description=[a.description,s.description]):(a.shape=x,a.description=s.description),a.description=g.sanitizeTextOrArray(a.description,h())),1===a.description.length&&a.shape===N&&(a.shape=x),!a.type&&s.doc&&(l.info("Setting cluster for ",o,P(s)),a.type="group",a.dir=P(s),a.shape=s.type===q?dt:Et,a.classes=a.classes+" "+At+" "+(r?gt:""));let i={labelStyle:"",shape:a.shape,labelText:a.description,classes:a.classes,style:"",id:o,dir:a.dir,domId:L(o,E),type:a.type,padding:15,centerLabel:!0};if(s.note){let e={labelStyle:"",shape:St,labelText:s.note.text,classes:Dt,style:"",id:o+$t+"-"+E,domId:L(o,E,F),type:a.type,padding:15},r={labelStyle:"",shape:pt,labelText:s.note.text,classes:a.classes,style:"",id:o+Q,domId:L(o,E,Z),type:"group",padding:0};E++;let l=o+Q;t.setNode(l,r),t.setNode(e.id,e),t.setNode(o,i),t.setParent(o,l),t.setParent(e.id,l);let n=o,d=e.id;"left of"===s.note.position&&(n=e.id,d=o),t.setEdge(n,d,{arrowhead:"none",arrowType:"",style:I,labelStyle:"",classes:ft,arrowheadStyle:tt,labelpos:et,labelType:ot,thickness:st})}else t.setNode(o,i)}e&&"root"!==e.id&&(l.trace("Setting node ",o," to be child of its parent ",e.id),t.setParent(o,e.id)),s.doc&&(l.trace("Adding nodes children "),Gt(t,s,s.doc,a,i,!r))},Gt=(t,e,s,a,i,r)=>{l.trace("items",s),s.forEach((s=>{switch(s.stmt){case W:case w:A(t,e,s,a,i,r);break;case z:{A(t,e,s.state1,a,i,r),A(t,e,s.state2,a,i,r);let o={id:"edge"+E,arrowhead:"normal",arrowTypeEnd:"arrow_barb",style:I,labelStyle:"",label:g.sanitizeText(s.description,h()),arrowheadStyle:tt,labelpos:et,labelType:ot,thickness:st,classes:X};t.setEdge(s.state1.id,s.state2.id,o,E),E++}}}))},P=(t,e=Y)=>{let s=e;if(t.doc)for(let a=0;a<t.doc.length;a++){let e=t.doc[a];"dir"===e.stmt&&(s=e.value)}return s},Nt=async function(t,e,s,a){l.info("Drawing state diagram (v2)",e),$={},a.db.getDirection();let{securityLevel:i,state:r}=h(),o=r.nodeSpacing||50,n=r.rankSpacing||50;l.info(a.db.getRootDocV2()),a.db.extract(a.db.getRootDocV2()),l.info(a.db.getRootDocV2());let d,c=a.db.getStates(),p=new H({multigraph:!0,compound:!0}).setGraph({rankdir:P(a.db.getRootDocV2()),nodesep:o,ranksep:n,marginx:8,marginy:8}).setDefaultEdgeLabel((function(){return{}}));A(p,void 0,a.db.getRootDocV2(),c,a.db,!0),"sandbox"===i&&(d=y("#i"+e));let g=y("sandbox"===i?d.nodes()[0].contentDocument.body:"body"),b=g.select(`[id="${e}"]`),u=g.select("#"+e+" g");await U(u,p,["barb"],_,e);j.insertTitle(b,"statediagramTitleText",r.titleTopMargin,a.db.getDiagramTitle());let m=b.node().getBBox(),f=m.width+16,w=m.height+16;b.attr("class",_);let T=b.node().getBBox();J(b,w,f,r.useMaxWidth);let E=`${T.x-8} ${T.y-8} ${f} ${w}`;l.debug(`viewBox ${E}`),b.attr("viewBox",E);let S=document.querySelectorAll('[id="'+e+'"] .edgeLabel .label');for(let l of S){let t=l.getBBox(),e=document.createElementNS("http://www.w3.org/2000/svg",x);e.setAttribute("rx",0),e.setAttribute("ry",0),e.setAttribute("width",t.width),e.setAttribute("height",t.height),l.insertBefore(e,l.firstChild)}},Lt={setConf:Ct,getClasses:Rt,draw:Nt},Wt={parser:V,db:G,renderer:Lt,styles:K,init:t=>{t.state||(t.state={}),t.state.arrowMarkerAbsolute=t.arrowMarkerAbsolute,G.clear()}};export{Wt as diagram};